---
import Highlight from '@/components/ui/Highlight.tsx';

const currentPath = Astro.url.pathname;

const navItems = [
  { path: '/journal', label: 'Journal', color: '#4CAF50' },
  { path: '/gallery', label: 'Gallery', color: '#FF9800' },
  { path: '/content', label: 'Content', color: '#9C27B0' },
];

const OPACITY = 0.3;
---

<header class="sticky top-0 z-40 bg-white/80 backdrop-blur-md border-b border-gray-200 py-2 px-4">
  <div class="flex justify-between items-center relative">
    <Highlight
      href="/"
      before={currentPath === '/' ? { bgColor: '#2196F3', bgOpacity: OPACITY } : {}}
      after={{ bgColor: '#2196F3', bgOpacity: OPACITY }}>
      Sharqawy
    </Highlight>

    <!-- Desktop Navigation -->
    <nav class="hidden sm:flex gap-8 items-center">
      {
        navItems.map(({ path, label, color }) => {
          const isActive = currentPath === path;
          return (
            <Highlight
              href={path}
              before={isActive ? { bgColor: color, bgOpacity: OPACITY } : {}}
              after={{ bgColor: color, bgOpacity: OPACITY }}>
              {label}
            </Highlight>
          );
        })
      }
    </nav>

    <!-- Mobile Menu Toggle -->
    <button id="mobile-menu-toggle" class="sm:hidden relative z-50" aria-label="Toggle mobile menu">
      <div class="w-6 h-5 relative">
        <span class="hamburger-line absolute top-1"></span>
        <span class="hamburger-line absolute top-2.5"></span>
        <span class="hamburger-line absolute top-4"></span>
      </div>
    </button>
  </div>

  <!-- Mobile Navigation Dropdown -->
  <nav
    id="mobile-nav"
    class="absolute inset-x-0 top-full z-50 flex w-full flex-col items-start justify-start gap-2 rounded-lg bg-white/95 backdrop-blur-xl px-4 py-6 shadow-lg border border-gray-200 transform scale-95 opacity-0 invisible transition-all duration-200 origin-top">
    {
      navItems.map(({ path, label }) => {
        const isActive = currentPath === path;
        return (
          <a
            href={path}
            class={`w-full px-4 py-3 text-left text-lg font-medium rounded-lg transition-colors duration-200 ${
              isActive ? 'bg-gray-100 text-gray-900' : 'text-gray-700 hover:bg-gray-50 hover:text-gray-900'
            }`}>
            {label}
          </a>
        );
      })
    }
  </nav>
</header>

<!-- Mobile Menu Backdrop -->
<div
  id="mobile-backdrop"
  class="fixed inset-0 bg-black/20 backdrop-blur-sm opacity-0 invisible transition-all duration-200 pointer-events-none z-30">
</div>

<style is:global>
  .hamburger-line {
    display: block;
    position: absolute;
    height: 2px;
    width: 100%;
    background-color: #1f2937;
    border-radius: 2px;
    transition: all 0.3s ease-in-out;
  }

  /* Hamburger to X animation */
  .menu-open .hamburger-line:nth-child(1) {
    transform: rotate(45deg);
    top: 10px !important;
  }

  .menu-open .hamburger-line:nth-child(2) {
    opacity: 0;
  }

  .menu-open .hamburger-line:nth-child(3) {
    transform: rotate(-45deg);
    top: 10px !important;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const toggleButton = document.getElementById('mobile-menu-toggle');
    const nav = document.getElementById('mobile-nav');
    const backdrop = document.getElementById('mobile-backdrop');

    if (!toggleButton || !nav || !backdrop) return;

    let isMenuOpen = false;

    function openMenu() {
      isMenuOpen = true;
      toggleButton!.classList.add('menu-open');
      nav!.classList.remove('scale-95', 'opacity-0', 'invisible');
      nav!.classList.add('scale-100', 'opacity-100', 'visible');
      backdrop!.classList.remove('opacity-0', 'invisible', 'pointer-events-none');
      backdrop!.classList.add('opacity-100', 'visible', 'pointer-events-auto');
    }

    function closeMenu() {
      isMenuOpen = false;
      toggleButton!.classList.remove('menu-open');
      nav!.classList.add('scale-95', 'opacity-0', 'invisible');
      nav!.classList.remove('scale-100', 'opacity-100', 'visible');
      backdrop!.classList.add('opacity-0', 'invisible', 'pointer-events-none');
      backdrop!.classList.remove('opacity-100', 'visible', 'pointer-events-auto');
    }

    // Toggle menu on button click
    toggleButton.addEventListener('click', e => {
      e.preventDefault();
      e.stopPropagation();
      if (isMenuOpen) {
        closeMenu();
      } else {
        openMenu();
      }
    });

    // Close menu when clicking outside
    document.addEventListener('click', e => {
      const target = e.target as HTMLElement;
      if (isMenuOpen && !nav.contains(target) && !toggleButton.contains(target)) {
        closeMenu();
      }
    });

    // Close menu when clicking backdrop
    backdrop.addEventListener('click', closeMenu);

    // Close menu when clicking nav links
    nav.addEventListener('click', e => {
      const target = e.target as HTMLElement;
      if (target && target.closest('a')) {
        closeMenu();
      }
    });

    // Close menu on escape key
    document.addEventListener('keydown', e => {
      if (e.key === 'Escape' && isMenuOpen) {
        closeMenu();
      }
    });
  });
</script>
