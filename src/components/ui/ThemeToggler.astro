---
import { Sun, Moon } from '@/components/icons/index.astro';
---

{/* CAUTION: This code is writted with magic, DO NOT TOUCH IT */}
{/* if you touch this code, YOU MUST TEST THE TOGGLE BUTTON 'AGGRESSIVELY' IN ALL CASES */}
<button
  id="theme-toggler"
  class="hover:text-primary text-foreground h-6 w-6 transition-colors duration-150"
  aria-label="Theme toggle button">
  <Moon class="hidden" />
  <Sun class="hidden" />
</button>

{
  /* 
  Dark mode toggler:
  - stores theme in localStorage as "t" = 'd' (dark) or 'l' (light)
  - applies html.dark instantly
  - swaps moon/sun icons (first/second <svg>)
  - click button #theme-toggler to toggle
*/
}

<script is:inline>
  // const b = document.getElementById('theme-toggler'),
  //   [m, s] = b.querySelectorAll('svg'),
  //   g = () => localStorage.getItem('t') || 'd',
  //   u = x => {
  //     localStorage.setItem('t', x);
  //     document.documentElement.classList.toggle('dark', x === 'd');
  //     m.classList.toggle('hidden', x !== 'd');
  //     s.classList.toggle('hidden', x === 'd');
  //   };
  // b.onclick = () => u(g() === 'd' ? 'l' : 'd');
  // u(g());

  // Apply theme immediately to prevent flash
  function applyThemeOnDoc(event) {
    const doc = event?.newDocument || document;
    const theme = localStorage.getItem('t') || 'd';
    doc.documentElement.classList.toggle('dark', theme === 'd');
  }

  // Apply on initial load immediately
  applyThemeOnDoc();
  // applyThemeOnDoc();
  // Apply before the new page content is shown (prevents flash)
  document.addEventListener('astro:before-swap', applyThemeOnDoc);
</script>
